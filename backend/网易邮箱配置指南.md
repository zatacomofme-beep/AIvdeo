# 📧 网易163邮箱配置指南

## 一、获取网易邮箱授权密码

### 步骤1：登录163邮箱

访问：https://mail.163.com 并登录您的邮箱

### 步骤2：开启SMTP服务

1. 点击顶部【设置】→【POP3/SMTP/IMAP】
2. 找到"POP3/SMTP服务"或"IMAP/SMTP服务"
3. 勾选"开启服务"
4. 点击"保存"

### 步骤3：设置授权密码

1. 在同一页面找到【客户端授权密码】
2. 点击"新增授权密码"
3. 输入手机验证码进行验证
4. 系统会生成一个**授权密码**（通常是一串字母加数字）
5. **重要**：这个授权密码不是您的邮箱登录密码！请妥善保存

---

## 二、修改 `.env` 配置文件

在 `backend/.env` 文件中找到邮件服务配置，修改为：

```bash
# 邮件服务（用于发送验证码）
# 网易163邮箱配置
SMTP_HOST=smtp.163.com
SMTP_PORT=25
SMTP_USER=您的163邮箱@163.com          # 例如：zhangsan@163.com
SMTP_PASSWORD=您的授权密码               # 刚才获取的授权密码
SENDER_EMAIL=您的163邮箱@163.com        # 与SMTP_USER相同
SENDER_NAME=SemoPic AI视频平台           # 发件人名称（可自定义）
```

### 配置示例

```bash
SMTP_HOST=smtp.163.com
SMTP_PORT=25
SMTP_USER=zhangsan@163.com
SMTP_PASSWORD=ABCD1234efgh5678
SENDER_EMAIL=zhangsan@163.com
SENDER_NAME=SemoPic AI视频平台
```

---

## 三、部署到服务器

### 方法1：手动部署（推荐）

```bash
# 1. 上传配置文件到服务器
scp backend\.env root@115.190.137.87:/root/backend/

# 2. 重启后端服务
ssh root@115.190.137.87 "cd /root/backend && pkill -f 'python.*main.py' && sleep 2 && nohup python3 main.py > logs/backend.log 2>&1 &"

# 3. 查看启动日志
ssh root@115.190.137.87 "tail -50 /root/backend/logs/backend.log"
```

### 方法2：直接在服务器上修改

```bash
# 1. SSH连接服务器
ssh root@115.190.137.87

# 2. 编辑配置文件
nano /root/backend/.env

# 3. 找到邮件配置部分，修改以下内容：
SMTP_HOST=smtp.163.com
SMTP_PORT=25
SMTP_USER=您的邮箱@163.com
SMTP_PASSWORD=您的授权密码
SENDER_EMAIL=您的邮箱@163.com
SENDER_NAME=SemoPic AI视频平台

# 4. 保存并退出（Ctrl+X, 然后按Y, 再按Enter）

# 5. 重启服务
cd /root/backend
pkill -f 'python.*main.py' && sleep 2 && nohup python3 main.py > logs/backend.log 2>&1 &

# 6. 查看日志
tail -50 logs/backend.log
```

---

## 四、测试验证码功能

### 1. 前端测试

1. 访问：https://semopic.com/app
2. 点击"注册"
3. 输入邮箱地址
4. 点击"发送验证码"
5. 检查邮箱是否收到验证码

### 2. 查看后端日志

```bash
# 查看验证码发送日志
ssh root@115.190.137.87 "tail -100 /root/backend/logs/backend.log | grep -E '验证码|邮件'"
```

**成功日志示例**：
```
[邮件] 验证码已发送到 user@example.com
[验证码] user@example.com: 123456
```

---

## 五、常见问题解答

### Q1: 为什么发送失败？

**可能原因及解决方法**：

1. **授权密码错误**
   - 确认使用的是授权密码，不是邮箱登录密码
   - 重新生成授权密码

2. **SMTP服务未开启**
   - 登录邮箱检查SMTP服务是否已开启
   - 确认勾选了"客户端授权密码"

3. **服务器网络问题**
   - 检查服务器是否能访问smtp.163.com
   - 测试命令：`ping smtp.163.com`

4. **端口被封**
   - 163邮箱默认使用25端口
   - 如果25端口被封，可以尝试使用465端口（SSL）或994端口

### Q2: 修改为使用SSL端口

如果25端口不可用，可以使用SSL加密端口：

```bash
SMTP_HOST=smtp.163.com
SMTP_PORT=465          # 或者 994
SMTP_USER=your_email@163.com
SMTP_PASSWORD=your_auth_password
SENDER_EMAIL=your_email@163.com
SENDER_NAME=SemoPic AI视频平台
```

**注意**：使用SSL端口需要修改后端代码，在发送邮件时启用SSL：

```python
# 在 backend/main.py 的 send_verification_email 函数中
with smtplib.SMTP_SSL(SMTP_HOST, SMTP_PORT) as server:  # 使用SMTP_SSL
    server.login(SMTP_USER, SMTP_PASSWORD)
    server.send_message(message)
```

### Q3: 收不到邮件怎么办？

1. **检查垃圾箱**
   - 验证码邮件可能被放入垃圾箱
   - 将发件人添加到白名单

2. **检查邮箱配额**
   - 确认邮箱没有满
   - 163免费邮箱有存储空间限制

3. **发送频率限制**
   - 163邮箱对发送频率有限制
   - 短时间内不要频繁发送
   - 建议间隔至少60秒

### Q4: 如何查看详细错误信息？

```bash
# 查看完整的错误日志
ssh root@115.190.137.87 "tail -200 /root/backend/logs/backend.log"

# 实时监控日志
ssh root@115.190.137.87 "tail -f /root/backend/logs/backend.log"
```

---

## 六、163邮箱 vs QQ邮箱对比

| 特性 | 163邮箱 | QQ邮箱 |
|------|---------|--------|
| SMTP主机 | smtp.163.com | smtp.qq.com |
| 默认端口 | 25 | 587 |
| SSL端口 | 465/994 | 465 |
| 授权方式 | 授权密码 | 授权码（16位） |
| 稳定性 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 配置难度 | 简单 | 简单 |
| 发送限制 | 较严格 | 相对宽松 |

**建议**：
- 如果您已有163邮箱，优先使用163
- 如果追求稳定性，推荐使用QQ邮箱
- 企业用户建议使用企业邮箱

---

## 七、安全建议

1. **不要泄露授权密码**
   - 授权密码具有完整的邮箱发送权限
   - 定期更换授权密码（建议3-6个月）

2. **不要将 `.env` 提交到Git**
   - 已添加到 `.gitignore`
   - 避免敏感信息泄露

3. **限制发送频率**
   - 前端已实现60秒倒计时
   - 建议在后端也添加IP限制

4. **监控异常发送**
   - 定期检查邮箱发送记录
   - 发现异常及时更换授权密码

---

## 八、快速配置检查清单

- [ ] 已登录163邮箱
- [ ] 已开启SMTP服务
- [ ] 已生成授权密码
- [ ] 已修改本地 `.env` 文件
- [ ] 已上传 `.env` 到服务器
- [ ] 已重启后端服务
- [ ] 已测试发送验证码
- [ ] 已收到验证码邮件

---

## 九、故障排查流程

```
发送失败
  ↓
查看后端日志
  ↓
是否有错误信息？
  ├─ 是 → 根据错误信息修正配置
  └─ 否 → 检查网络连接
       ↓
    能否ping通smtp.163.com？
       ├─ 是 → 检查端口是否开放
       └─ 否 → 检查防火墙或网络设置
            ↓
         尝试更换端口（465/994）
            ↓
         仍失败？联系服务器管理员
```

---

## 十、联系支持

- **163邮箱帮助**：https://help.mail.163.com/
- **技术支持**：163邮箱客服
- **后端日志路径**：`/root/backend/logs/backend.log`

完成配置后，验证码将通过163邮箱发送！📧
