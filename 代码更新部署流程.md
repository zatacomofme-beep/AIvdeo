# ðŸ”„ ä»£ç æ›´æ–°éƒ¨ç½²æµç¨‹

å½“æ‚¨ä¿®æ”¹äº†æœ¬åœ°ä»£ç åŽï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤é‡æ–°éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

---

## ðŸ“¦ æ–¹å¼ä¸€ï¼šå®Œæ•´æ›´æ–°ï¼ˆæŽ¨èï¼‰

### 1ï¸âƒ£ æœ¬åœ°æ‰“åŒ…

```powershell
cd C:\Users\Administrator\Desktop\AIvdeo

# æ‰“åŒ…é¡¹ç›®ï¼ˆæŽ’é™¤ä¸å¿…è¦æ–‡ä»¶ï¼‰
tar --exclude='node_modules' --exclude='.git' --exclude='dist' --exclude='backend/venv' --exclude='.venv' --exclude='*.log' --exclude='.env' -czf aivideo.tar.gz .
```

### 2ï¸âƒ£ ä¸Šä¼ åˆ°æœåŠ¡å™¨

```powershell
scp aivideo.tar.gz root@115.190.137.87:/tmp/
```

### 3ï¸âƒ£ ç™»å½•æœåŠ¡å™¨å¹¶æ›´æ–°

```bash
ssh root@115.190.137.87

# å¤‡ä»½ .env é…ç½®
cp /root/backend/.env /tmp/backend.env.backup

# åœæ­¢åŽç«¯æœåŠ¡
pm2 stop aivideo-backend

# æ¸…ç†æ—§ä»£ç 
rm -rf /root/src /root/dist /root/node_modules /root/backend
rm -f /root/package.json /root/vite.config.ts /root/tailwind.config.js /root/index.html

# è§£åŽ‹æ–°ä»£ç 
cd /root
tar -xzf /tmp/aivideo.tar.gz

# æ¢å¤ .env é…ç½®
cp /tmp/backend.env.backup /root/backend/.env

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f /tmp/aivideo.tar.gz /tmp/backend.env.backup
```

### 4ï¸âƒ£ é‡æ–°éƒ¨ç½²

```bash
# å®‰è£…åŽç«¯ä¾èµ–ï¼ˆå¦‚æžœæœ‰æ–°ä¾èµ–ï¼‰
cd /root/backend
source venv/bin/activate
pip install -r requirements.txt

# é‡å¯åŽç«¯æœåŠ¡
pm2 restart aivideo-backend

# å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆå¦‚æžœæœ‰æ–°ä¾èµ–ï¼‰
cd /root
npm install

# é‡æ–°æž„å»ºå‰ç«¯
npm run build

# é‡å¯ Nginx
systemctl reload nginx

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status
```

---

## âš¡ æ–¹å¼äºŒï¼šå¿«é€Ÿæ›´æ–°ï¼ˆä»…å‰ç«¯æˆ–åŽç«¯ï¼‰

### ä»…æ›´æ–°å‰ç«¯

```bash
ssh root@115.190.137.87

# ä¸Šä¼ å‰ç«¯æ–‡ä»¶åŽ
cd /root
npm install  # å¦‚æžœä¾èµ–æœ‰å˜åŒ–
npm run build
systemctl reload nginx
```

### ä»…æ›´æ–°åŽç«¯

```bash
ssh root@115.190.137.87

# ä¸Šä¼ åŽç«¯æ–‡ä»¶åŽ
cd /root/backend
source venv/bin/activate
pip install -r requirements.txt  # å¦‚æžœä¾èµ–æœ‰å˜åŒ–
pm2 restart aivideo-backend
```

---

## ðŸ” éªŒè¯éƒ¨ç½²

```bash
# æŸ¥çœ‹åŽç«¯æ—¥å¿—
pm2 logs aivideo-backend --lines 50

# æµ‹è¯•åŽç«¯ API
curl http://localhost:8000/api/health

# æŸ¥çœ‹å‰ç«¯æ–‡ä»¶
ls -lh /root/dist/

# æµ‹è¯•ç½‘ç«™è®¿é—®
curl -I https://semopic.com
```

---

## ðŸ“‹ ä¸€é”®æ›´æ–°è„šæœ¬ï¼ˆæŽ¨èï¼‰

åˆ›å»ºä¸€ä¸ªæ›´æ–°è„šæœ¬ï¼Œä»¥åŽåªéœ€æ‰§è¡Œä¸€æ¬¡å³å¯ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæ›´æ–°è„šæœ¬
cat > /root/update_aivideo.sh << 'EOF'
#!/bin/bash

set -e

echo "=========================================="
echo "å¼€å§‹æ›´æ–° AI è§†é¢‘ç”Ÿæˆé¡¹ç›®"
echo "=========================================="

# 1. å¤‡ä»½é…ç½®
echo "[1/6] å¤‡ä»½é…ç½®æ–‡ä»¶..."
cp /root/backend/.env /tmp/backend.env.backup
echo "âœ“ é…ç½®å·²å¤‡ä»½"

# 2. åœæ­¢æœåŠ¡
echo "[2/6] åœæ­¢åŽç«¯æœåŠ¡..."
pm2 stop aivideo-backend
echo "âœ“ æœåŠ¡å·²åœæ­¢"

# 3. æ¸…ç†æ—§ä»£ç 
echo "[3/6] æ¸…ç†æ—§ä»£ç ..."
rm -rf /root/src /root/dist /root/node_modules /root/backend
rm -f /root/package.json /root/vite.config.ts /root/tailwind.config.js /root/index.html
echo "âœ“ æ—§ä»£ç å·²æ¸…ç†"

# 4. è§£åŽ‹æ–°ä»£ç 
echo "[4/6] è§£åŽ‹æ–°ä»£ç ..."
cd /root
tar -xzf /tmp/aivideo.tar.gz
cp /tmp/backend.env.backup /root/backend/.env
rm -f /tmp/aivideo.tar.gz /tmp/backend.env.backup
echo "âœ“ æ–°ä»£ç å·²éƒ¨ç½²"

# 5. æ›´æ–°ä¾èµ–å¹¶æž„å»º
echo "[5/6] æ›´æ–°ä¾èµ–..."
cd /root/backend
source venv/bin/activate
pip install -r requirements.txt

cd /root
npm install
npm run build
echo "âœ“ æž„å»ºå®Œæˆ"

# 6. é‡å¯æœåŠ¡
echo "[6/6] é‡å¯æœåŠ¡..."
pm2 restart aivideo-backend
systemctl reload nginx
echo "âœ“ æœåŠ¡å·²é‡å¯"

echo ""
echo "=========================================="
echo "âœ¨ æ›´æ–°å®Œæˆï¼"
echo "=========================================="
echo ""
echo "æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š"
pm2 status
echo ""
echo "è®¿é—®ç½‘ç«™ï¼š"
echo "  https://semopic.com"
echo "  https://www.semopic.com"

EOF

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /root/update_aivideo.sh
```

### ä½¿ç”¨ä¸€é”®æ›´æ–°è„šæœ¬

ä»¥åŽæ›´æ–°ä»£ç æ—¶ï¼Œåªéœ€ï¼š

```powershell
# æœ¬åœ°æ‰“åŒ…
cd C:\Users\Administrator\Desktop\AIvdeo
tar --exclude='node_modules' --exclude='.git' --exclude='dist' --exclude='backend/venv' --exclude='.venv' --exclude='*.log' --exclude='.env' -czf aivideo.tar.gz .

# ä¸Šä¼ 
scp aivideo.tar.gz root@115.190.137.87:/tmp/

# æ‰§è¡Œæ›´æ–°è„šæœ¬
ssh root@115.190.137.87 "bash /root/update_aivideo.sh"
```

---

## ðŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šå‰ç«¯æž„å»ºå¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜é‡æ–°æž„å»º
cd /root
rm -rf node_modules package-lock.json dist
npm install
npm run build
```

### é—®é¢˜2ï¼šåŽç«¯å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pm2 logs aivideo-backend --lines 100

# é‡æ–°å®‰è£…ä¾èµ–
cd /root/backend
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt --force-reinstall
```

### é—®é¢˜3ï¼šæ•°æ®åº“è¿ç§»

å¦‚æžœä¿®æ”¹äº†æ•°æ®åº“æ¨¡åž‹ï¼š

```bash
cd /root/backend
source venv/bin/activate

# ç”Ÿæˆè¿ç§»æ–‡ä»¶
alembic revision --autogenerate -m "æè¿°ä¿®æ”¹å†…å®¹"

# æ‰§è¡Œè¿ç§»
alembic upgrade head
```

---

## âœ… æ›´æ–°æ£€æŸ¥æ¸…å•

- [ ] æœ¬åœ°ä»£ç å·²æµ‹è¯•
- [ ] å·²å¤‡ä»½ .env é…ç½®
- [ ] ä»£ç å·²æ‰“åŒ…ä¸Šä¼ 
- [ ] åŽç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å‰ç«¯æž„å»ºæˆåŠŸ
- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] API æŽ¥å£æ­£å¸¸å“åº”

---

## ðŸ’¡ æœ€ä½³å®žè·µ

1. **æ›´æ–°å‰å…ˆæµ‹è¯•**ï¼šç¡®ä¿æœ¬åœ°ä»£ç è¿è¡Œæ­£å¸¸
2. **ä¿ç•™ .env**ï¼šçŽ¯å¢ƒé…ç½®æ–‡ä»¶è‡ªåŠ¨å¤‡ä»½æ¢å¤
3. **æŸ¥çœ‹æ—¥å¿—**ï¼šæ›´æ–°åŽæ£€æŸ¥ `pm2 logs` ç¡®è®¤æ— é”™è¯¯
4. **åˆ†æ­¥æ›´æ–°**ï¼šé‡å¤§æ›´æ–°å»ºè®®å…ˆåœ¨æµ‹è¯•çŽ¯å¢ƒéªŒè¯
5. **å®šæœŸå¤‡ä»½**ï¼šé‡è¦æ•°æ®å®šæœŸå¤‡ä»½åˆ°å…¶ä»–ä½ç½®

---

ðŸŽ‰ çŽ°åœ¨æ‚¨å¯ä»¥éšæ—¶æ›´æ–°ä»£ç äº†ï¼
