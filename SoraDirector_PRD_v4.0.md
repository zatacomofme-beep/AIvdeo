# SoraDirector æ–°ç‰ˆåˆ›ä½œæµç¨‹ PRDï¼ˆv4.0ï¼‰

## 1. ç›®æ ‡ä¸èƒŒæ™¯
- ç›®æ ‡ï¼šå°†åˆ›ä½œæµç¨‹é‡æ„ä¸º Aâ†’H çš„åˆ†é˜¶æ®µé—­ç¯ï¼Œæå‡å¯æ§æ€§ã€ç”¨æˆ·å‚ä¸åº¦ä¸è„šæœ¬è´¨é‡ï¼Œå¹¶é™ä½â€œä¸€é”®ç”Ÿæˆâ€å¸¦æ¥çš„åå·®ã€‚
- èƒŒæ™¯ï¼šå½“å‰ç³»ç»Ÿæ”¯æŒâ€œä¸Šä¼ â†’è¡¨å•â†’ä¸€æ¬¡æ€§ç”Ÿæˆè„šæœ¬â†’ç”Ÿæˆè§†é¢‘â€å’Œå¯¹è¯å¼å¼•å¯¼ï¼Œè®¡åˆ’å¼•å…¥é˜¶æ®µåŒ–ç®¡çº¿ï¼Œä»¥ç»“æ„åŒ–æ²‰æ·€æ¯æ­¥äº§å‡ºã€‚

## 2. èŒƒå›´ä¸ä¸åœ¨èŒƒå›´
- åœ¨èŒƒå›´ï¼šæ–°å¢é˜¶æ®µçŠ¶æ€æœºã€B é˜¶æ®µâ€œAI äº§å“ç†è§£å¹¶å¯ç¼–è¾‘ç¡®è®¤â€ã€C/D/E/F é˜¶æ®µçš„ç»“æ„åŒ–è¾“å‡ºä¸ UIã€ä¸‰è„šæœ¬é€‰æ‹©ã€ç”Ÿæˆè§†é¢‘çš„ Prompt ç»„è£…ã€‚
- ä¸åœ¨èŒƒå›´ï¼šè´¦å·ç³»ç»Ÿã€è®¡è´¹ä¸é¢åº¦ç­–ç•¥ã€ä½œå“åº“æ•°æ®æŒä¹…åŒ–ï¼ˆä¿æŒç°çŠ¶ï¼‰ã€‚

## 3. ç”¨æˆ·æ—…ç¨‹ï¼ˆAâ†’Hï¼‰
- A äº§å“å›¾ç‰‡ä¸Šä¼ ï¼šç”¨æˆ·æ‹–æ‹½æˆ–é€‰æ‹©å›¾ç‰‡ï¼Œç³»ç»Ÿå¹¶å‘ä¸Šä¼ åˆ° TOS å¹¶è½¬ base64ï¼Œè¿›å…¥ Bã€‚
- B AI äº§å“ç†è§£ï¼ˆå¯ç¼–è¾‘ï¼‰ï¼šAI è¾“å‡ºâ€œäº§å“åç§°/ç±»å‹/å…³é”®å±æ€§/å°ºå¯¸å»ºè®®â€ï¼Œç”¨æˆ·ç¼–è¾‘ä¸ç¡®è®¤ã€‚
- C å¸‚åœºå®šä½åˆ†æï¼šAI ç»™å‡ºç›®æ ‡å¸‚åœºã€äººç¾¤ç»†åˆ†ã€persona å»ºè®®ï¼Œç”¨æˆ·ç¡®è®¤ã€‚
- D åˆ›æ„ç­–ç•¥ç”Ÿæˆï¼šAI è¾“å‡ºæ ¸å¿ƒä¿¡æ¯ã€ç—›ç‚¹-è§£å†³ã€æƒ…ç»ªæ›²çº¿ä¸å™äº‹ç­–ç•¥ï¼Œç”¨æˆ·ç¡®è®¤æˆ–å¾®è°ƒã€‚
- E è§†è§‰é£æ ¼åŒ¹é…ï¼šAI è¾“å‡ºé£æ ¼å€™é€‰ï¼ˆchips æˆ–å¡ç‰‡ï¼‰ï¼Œç”¨æˆ·é€‰æ‹© 1 ä¸ªé£æ ¼ã€‚
- F ä¸‰ä¸ªè„šæœ¬è‡ªåŠ¨åˆ›ä½œï¼šAI æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆ 3 å¥— 10s è„šæœ¬ï¼Œåˆ†é•œã€åŠ¨ä½œã€å°è¯ã€æƒ…ç»ªã€‚
- G ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©è„šæœ¬ï¼šå¯¹æ¯”é¢„è§ˆä¸‰å¥—è„šæœ¬ï¼Œé€‰æ‹©å…¶ä¸€ä½œä¸ºæœ€ç»ˆè„šæœ¬ã€‚
- H ç¡®è®¤ç‚¹å‡»è§†é¢‘ç”Ÿæˆï¼šç»„è£…æœ€ç»ˆ Prompt è°ƒç”¨è§†é¢‘ç”Ÿæˆæ¨¡å‹ï¼Œå±•ç¤ºçŠ¶æ€ä¸ç»“æœã€‚

## 4. æˆåŠŸåº¦é‡
- ç”ŸæˆæˆåŠŸç‡ï¼šFâ†’H å…¨é“¾è·¯æˆåŠŸç‡ â‰¥ 90%
- ç”¨æˆ·å‚ä¸åº¦ï¼šB/C/D/E/G é˜¶æ®µè‡³å°‘ 3 æ¬¡æœ‰æ•ˆäº¤äº’
- è„šæœ¬è´¨é‡ï¼šç”¨æˆ·é€‰æ‹©è„šæœ¬çš„å¹³å‡åœç•™æ—¶é—´ä¸æ»¡æ„åº¦ï¼ˆåç»­åŸ‹ç‚¹ï¼‰
- å¤±è´¥æ¢å¤ï¼šå„é˜¶æ®µå¤±è´¥åâ€œé‡è¯•/è·³è¿‡/å›é€€â€å¯ç”¨ç‡ â‰¥ 99%

## 5. ä¿¡æ¯æ¶æ„ä¸æ•°æ®æ¨¡å‹ï¼ˆå‰ç«¯çŠ¶æ€ï¼‰
- `pipelineStage`: `'image_uploaded' | 'product_understanding' | 'market_analysis' | 'creative_strategy' | 'style_matching' | 'scripts_generated' | 'script_selected' | 'ready_to_render'`
- `productUnderstanding`: `{ productName, productType, attributes?: {material?, color?, shape?}, sizeOptions: {label, value, description}[] }`
- `marketAnalysis`: `{ market, segments?: string[], persona?: {age, gender, traits[]} }`
- `creativeStrategy`: `{ keyMessage, painReliefArc: string[], tone, narrative }`
- `visualStyle`: `{ id, label, pros?: string[], cons?: string[] }`
- `scriptOptions`: `ScriptItem[][]`ï¼ˆä¸‰å¥—è„šæœ¬ï¼‰
- `selectedScript`: `ScriptItem[]`

## 6. åç«¯ API è®¾è®¡
- é€šç”¨è¿”å›ç»“æ„ï¼š
  - `success: boolean`
  - `projectUpdate?: { productUnderstanding?, marketAnalysis?, creativeStrategy?, visualStyle?, scriptOptions?, selectedScript? }`
  - `error?: string`
- æ–°å¢è·¯ç”±ï¼š
  - `POST /understand-product`
    - å…¥å‚ï¼š`{ imageUrl?: string, imageBase64?: string }`
    - å‡ºå‚ç¤ºä¾‹ï¼š
      ```json
      {
        "success": true,
        "projectUpdate": {
          "productUnderstanding": {
            "productName": "ç«ç‘°ç²¾åå£çº¢",
            "productType": "lipstick",
            "attributes": { "material": "metal", "color": "rose", "shape": "stick" },
            "sizeOptions": [
              { "label": "ğŸ’„ å£çº¢çº§ (10cm)", "value": "mini", "description": "çº¦10cm" },
              { "label": "ğŸ¥¤ çŸ¿æ³‰æ°´ç“¶çº§ (30cm)", "value": "normal", "description": "çº¦30cm" },
              { "label": "ğŸ¾ å¤§é…’ç“¶çº§ (50cm+)", "value": "large", "description": "çº¦50cm+" }
            ]
          }
        }
      }
      ```
  - `POST /analyze-market` å…¥å‚ï¼š`{ productUnderstanding, overrides? }`ï¼›å‡ºå‚ï¼š`marketAnalysis`
  - `POST /generate-strategy` å…¥å‚ï¼š`{ productUnderstanding, marketAnalysis }`ï¼›å‡ºå‚ï¼š`creativeStrategy`
  - `POST /match-style` å…¥å‚ï¼š`{ productUnderstanding, marketAnalysis, creativeStrategy }`ï¼›å‡ºå‚ï¼š`visualStyle æˆ– styleCandidates`
  - `POST /generate-scripts` å…¥å‚ï¼š`{ productUnderstanding, marketAnalysis, creativeStrategy, visualStyle }`ï¼›å‡ºå‚ï¼š`scriptOptions`ï¼ˆä¸‰å¥—ï¼‰
- å¤ç”¨ç°æœ‰ç«¯ç‚¹ï¼š
  - ä¸Šä¼ å›¾ç‰‡ï¼š`POST /upload-image`
  - ç”Ÿæˆè§†é¢‘ï¼š`POST /generate-video`
  - æŸ¥è¯¢ä»»åŠ¡ï¼š`POST /query-video-task`
  - è¾…åŠ©å¯¹è¯ï¼š`POST /chat`

## 7. Prompt è§„åˆ™ï¼ˆé˜¶æ®µåŒ–ï¼‰
- é€šç”¨ç³»ç»Ÿè§’è‰²ï¼šä¸­æ–‡ã€å¯¼æ¼”åŠ©ç†ã€åˆ†é˜¶æ®µã€ç»“æ„åŒ–è¾“å‡ºã€å°‘å¹¿å‘Šè¯­ã€‚
- åˆ†é˜¶æ®µæ¨¡æ¿è¦ç‚¹ï¼š
  - `/understand-product`ï¼šè¾“å‡º `productName/productType/attributes/sizeOptions`ï¼ˆå›ºå®šä¸‰æš chipsï¼‰ï¼›å¤±è´¥å…œåº•è¿”å›é»˜è®¤ä¸‰å°ºå¯¸ã€‚
  - `/analyze-market`ï¼šè¾“å‡º `market/segments/persona`
  - `/generate-strategy`ï¼šè¾“å‡º `keyMessage/painReliefArc/tone/narrative`
  - `/match-style`ï¼šè¾“å‡ºé£æ ¼å€™é€‰æˆ–æœ€ç»ˆé£æ ¼
  - `/generate-scripts`ï¼šè¾“å‡ºä¸‰å¥—è„šæœ¬ï¼Œæ¯å¥—åŒ…å« `time/scene/action/audio/emotion`

## 8. å‰ç«¯äº¤äº’è®¾è®¡
- ä¸Šä¼ ä¸è¿›å…¥ Bï¼šä¸Šä¼ åè°ƒç”¨ `/understand-product`ï¼Œæ˜¾ç¤ºâ€œäº§å“ç†è§£é¢æ¿â€ï¼ˆAI é¢„å¡«ï¼Œç”¨æˆ·å¯ç¼–è¾‘ï¼‰ï¼Œå°ºå¯¸ chips å¯è¦†ç›–é€‰æ‹©ã€‚
- é˜¶æ®µæ§åˆ¶ä¸å›é€€ï¼šAâ†’H è¿›åº¦æ¡ï¼›æ¯é˜¶æ®µæä¾›â€œè¿”å›ä¸Šä¸€æ­¥/é‡æ–°ç”Ÿæˆ/è·³è¿‡â€ã€‚
- ä¸‰è„šæœ¬é€‰æ‹©ï¼šä¸‰å¡å¯¹æ¯”æ¦‚è§ˆ + è¯¦æƒ…é¢„è§ˆï¼›é€‰æ‹©åå†™å…¥ `selectedScript` è¿›å…¥ Hã€‚
- è§†é¢‘ç”Ÿæˆï¼šç»„è£…æœ€ç»ˆ Promptï¼ˆ`[CONSTRAINTS][CHARACTER][STRATEGY][STYLE][SCRIPT][SCENE]`ï¼‰å¹¶è°ƒç”¨ç°æœ‰ç”Ÿæˆæ¥å£ã€‚

## 9. åç«¯å®ç°è¦ç‚¹
- ä½ç½®ï¼šæ–°å¢é˜¶æ®µè·¯ç”±ç½®äºè„šæœ¬ç”Ÿæˆè·¯ç”±é™„è¿‘ï¼Œå¤ç”¨ `chat_with_ai`ã€‚
- è§£æï¼šç»Ÿä¸€ `re + json.loads`ï¼›å¼‚å¸¸æ—¶è¿”å› `success=false` ä¸å®‰å…¨å…œåº•ã€‚
- æ—¥å¿—ï¼šæ‰“å° `model/payload/raw_response/parsed_result`ï¼›ä¿ç•™ `request_id`ã€‚
- å®‰å…¨ï¼šä¸è½ç›˜ç”¨æˆ·å›¾ç‰‡ï¼›ä¸è¿”å›æ•æ„Ÿç¯å¢ƒå˜é‡ï¼›ä¸è®°å½•å®Œæ•´ base64ï¼ˆåªç»Ÿè®¡é•¿åº¦ï¼‰ã€‚

## 10. é”™è¯¯å¤„ç†ä¸é™çº§
- ç½‘ç»œå¤±è´¥ï¼šæç¤ºâ€œé‡è¯•â€ï¼Œæ”¯æŒè·³è¿‡å½“å‰é˜¶æ®µä½¿ç”¨é»˜è®¤å€¼ç»§ç»­ã€‚
- JSON è§£æå¤±è´¥ï¼šå±•ç¤º AI åŸæ–‡ä¸â€œä½¿ç”¨é»˜è®¤å»ºè®®â€æŒ‰é’®ã€‚
- æ¨¡å‹ä¸å¯ç”¨ï¼šè¿›å…¥â€œæ¨¡æ‹Ÿæ¨¡å¼â€ï¼Œè¿”å›é™æ€æ¨¡æ¿ï¼ˆä¸‰å°ºå¯¸ã€é€šç”¨ personaã€ä¸‰è„šæœ¬æ¨¡æ¿ï¼‰ã€‚
- å›é€€ï¼šä»»æ„é˜¶æ®µæ”¯æŒå›åˆ° B é‡ç½®äº§å“ç†è§£ï¼Œåç»­é˜¶æ®µè‡ªåŠ¨å¤±æ•ˆå¹¶é‡æ–°è®¡ç®—ã€‚

## 11. åŸ‹ç‚¹ä¸æŒ‡æ ‡
- é˜¶æ®µåœç•™æ—¶é•¿ï¼šB/C/D/E/F/G å•æ­¥åœç•™æ—¶é—´ä¸æ“ä½œæ¬¡æ•°ã€‚
- é€‰æ‹©åå¥½ï¼šE çš„é£æ ¼å€¾å‘ã€G çš„è„šæœ¬é€‰æ‹©åˆ†å¸ƒã€‚
- ç”ŸæˆæˆåŠŸï¼šH çš„çŠ¶æ€åˆ†å¸ƒä¸é”™è¯¯ç ç±»åˆ«ã€‚

## 12. é‡Œç¨‹ç¢‘ä¸å®æ–½è®¡åˆ’
- M1ï¼šåç«¯ `/understand-product` ä¸å‰ç«¯ B é¢æ¿ï¼ˆB å¯ç¼–è¾‘ç¡®è®¤ï¼‰ã€‚
- M2ï¼šåç«¯ `/generate-scripts` ä¸å‰ç«¯ä¸‰è„šæœ¬é€‰æ‹©ï¼ˆF/G å¯è§†åŒ–ï¼‰ã€‚
- M3ï¼šè¡¥é½ `/analyze-market`ã€`/generate-strategy`ã€`/match-style`ï¼Œä¸²è”ä¸Šä¸‹æ–‡ã€‚
- M4ï¼šç»Ÿä¸€ Prompt ç»„è£…ï¼Œä¼˜åŒ–ç”Ÿæˆä½“éªŒä¸å®¹é”™ã€‚
- M5ï¼šæŒ‡æ ‡ä¸åŸ‹ç‚¹ï¼ŒA/B å®éªŒé£æ ¼ä¸ç­–ç•¥æ¨¡æ¿ã€‚

## 13. å‚è€ƒç°æœ‰ä»£ç ä½
- å‰ç«¯å…¥å£ä¸å†…å®¹åˆ‡æ¢ï¼š`src/main.tsx`ã€`src/App.tsx`
- ä¸Šä¼ ä¸å¹¶å‘å¤„ç†ï¼š`src/components/layout/VisualCanvas.tsx`
- æ§åˆ¶å°äº¤äº’ä¸èŠ¯ç‰‡ï¼š`src/components/layout/DirectorConsole.tsx`
- ä¸€é”®ç”Ÿæˆè„šæœ¬ç°çŠ¶ï¼š`src/components/layout/DirectorConsole.tsx`
- API å°è£…å±‚ï¼š`src/lib/api.ts`
- åç«¯è„šæœ¬ç”Ÿæˆå‚è€ƒï¼š`backend/main.py`
- å¤šæ¨¡æ€å¯¹è¯å°è£…ï¼š`backend/main.py`
- è§†é¢‘ç”Ÿæˆæµç¨‹ï¼š`backend/main.py`
