# ğŸš€ æ‰‹åŠ¨éƒ¨ç½²æŒ‡å— - semopic.com

## ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šæ‰“åŒ…é¡¹ç›®ä»£ç 

åœ¨æœ¬åœ° PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
cd C:\Users\Administrator\Desktop\AIvdeo

# æ‰“åŒ…é¡¹ç›®ï¼ˆæ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼‰
tar --exclude='node_modules' --exclude='.git' --exclude='dist' --exclude='backend/venv' --exclude='.venv' --exclude='*.log' --exclude='.env' -czf aivideo.tar.gz .
```

**æ‰“åŒ…å®Œæˆå**ï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ `aivideo.tar.gz` æ–‡ä»¶ã€‚

---

## ğŸ“¤ ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ SCP ä¸Šä¼ 

```powershell
# ä¸Šä¼ ä»£ç åŒ…
scp aivideo.tar.gz root@115.190.137.87:/tmp/

# ä¸Šä¼ éƒ¨ç½²è„šæœ¬
scp deploy_server.sh root@115.190.137.87:/root/
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ SFTP å·¥å…·ï¼ˆæ¨èæ–°æ‰‹ï¼‰

å¯ä»¥ä½¿ç”¨ **WinSCP** æˆ– **FileZilla**ï¼š

1. è¿æ¥ä¿¡æ¯ï¼š
   - ä¸»æœºï¼š`115.190.137.87`
   - ç”¨æˆ·åï¼š`root`
   - ç«¯å£ï¼š`22`

2. ä¸Šä¼ æ–‡ä»¶ï¼š
   - `aivideo.tar.gz` â†’ `/tmp/`
   - `deploy_server.sh` â†’ `/root/`

---

## ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šç™»å½•æœåŠ¡å™¨è§£å‹ä»£ç 

```bash
# ç™»å½•æœåŠ¡å™¨
ssh root@115.190.137.87

# å¤‡ä»½ç°æœ‰çš„ .env é…ç½®ï¼ˆå¦‚æœæœ‰ï¼‰
if [ -f /root/backend/.env ]; then
    cp /root/backend/.env /tmp/backend.env.backup
    echo "âœ“ å·²å¤‡ä»½ .env é…ç½®"
fi

# æ¸…ç†æ—§ä»£ç 
echo "æ¸…ç†æ—§ä»£ç ..."
rm -rf /root/src /root/dist /root/node_modules
rm -f /root/package.json /root/package-lock.json
rm -f /root/vite.config.ts /root/tailwind.config.js
rm -f /root/postcss.config.mjs /root/index.html
rm -rf /root/backend

# è§£å‹æ–°ä»£ç 
cd /root
tar -xzf /tmp/aivideo.tar.gz

# æ¢å¤ .env é…ç½®
if [ -f /tmp/backend.env.backup ]; then
    cp /tmp/backend.env.backup /root/backend/.env
    echo "âœ“ å·²æ¢å¤ .env é…ç½®"
fi

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f /tmp/aivideo.tar.gz /tmp/backend.env.backup

echo "âœ“ ä»£ç è§£å‹å®Œæˆï¼"
```

---

## âš™ï¸ ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœè¿˜æ²¡é…ç½®ï¼‰

```bash
# æ£€æŸ¥ .env æ–‡ä»¶
if [ ! -f /root/backend/.env ]; then
    echo "éœ€è¦é…ç½® .env æ–‡ä»¶"
    vi /root/backend/.env
fi
```

**`.env` é…ç½®å†…å®¹ï¼š**

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://ç”¨æˆ·å:å¯†ç @192.168.19.67:5432/aivideo

# ç«å±±äº‘TOSå¯¹è±¡å­˜å‚¨
TOS_ACCESS_KEY=æ‚¨çš„TOSè®¿é—®å¯†é’¥
TOS_SECRET_KEY=æ‚¨çš„TOSç§˜å¯†å¯†é’¥
TOS_BUCKET=æ‚¨çš„æ¡¶åç§°
TOS_ENDPOINT=tos-cn-beijing.volces.com
TOS_REGION=cn-beijing

# APIå¯†é’¥
OPENAI_API_KEY=æ‚¨çš„OpenAIå¯†é’¥
SORA2_API_KEY=æ‚¨çš„Sora2å¯†é’¥
SORA2_API_URL=https://api.sora2.com

# JWTå¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰
SECRET_KEY=éšæœºç”Ÿæˆçš„å¯†é’¥å­—ç¬¦ä¸²

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000
```

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x /root/deploy_server.sh

# æ‰§è¡Œéƒ¨ç½²
bash /root/deploy_server.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆnginxã€postgresql-devel ç­‰ï¼‰
2. âœ… å®‰è£… Node.js 18
3. âœ… å®‰è£… Python 3.9
4. âœ… å®‰è£… PM2 è¿›ç¨‹ç®¡ç†å™¨
5. âœ… é…ç½®åç«¯ Python è™šæ‹Ÿç¯å¢ƒ
6. âœ… å®‰è£…åç«¯ä¾èµ–
7. âœ… å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£ 8000ï¼‰
8. âœ… æ„å»ºå‰ç«¯ï¼ˆnpm run buildï¼‰
9. âœ… é…ç½® Nginx
10. âœ… é…ç½®é˜²ç«å¢™

---

## ğŸ” ç¬¬å…­æ­¥ï¼šæ£€æŸ¥éƒ¨ç½²çŠ¶æ€

```bash
# æŸ¥çœ‹ PM2 è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs aivideo-backend

# æŸ¥çœ‹ Nginx çŠ¶æ€
systemctl status nginx

# æµ‹è¯•åç«¯ API
curl http://localhost:8000/api/health

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tulnp | grep -E ':80|:8000'
```

**æœŸæœ›ç»“æœï¼š**
- PM2 æ˜¾ç¤º `aivideo-backend` çŠ¶æ€ä¸º `online`
- Nginx çŠ¶æ€ä¸º `active (running)`
- ç«¯å£ 80 å’Œ 8000 éƒ½åœ¨ç›‘å¬

---

## ğŸŒ ç¬¬ä¸ƒæ­¥ï¼šè®¿é—®ç½‘ç«™

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- http://semopic.com
- http://www.semopic.com

---

## ğŸ” ç¬¬å…«æ­¥ï¼šé…ç½® SSLï¼ˆå¯é€‰ï¼Œæ¨èï¼‰

```bash
# å®‰è£… Certbot
yum install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
certbot --nginx -d semopic.com -d www.semopic.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

é…ç½®å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ HTTPS è®¿é—®ï¼š
- https://semopic.com
- https://www.semopic.com

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯
pm2 restart aivideo-backend

# é‡å¯ Nginx
systemctl restart nginx
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
pm2 logs aivideo-backend

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log

# Nginx è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log
```

### æ›´æ–°ä»£ç 
```bash
# å¦‚æœéœ€è¦å†æ¬¡æ›´æ–°ï¼Œé‡å¤æ­¥éª¤1-5å³å¯
# æ³¨æ„ï¼š.env é…ç½®ä¼šè‡ªåŠ¨ä¿ç•™
```

---

## â“ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šåç«¯å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ Python ä¾èµ–
cd /root/backend
source venv/bin/activate
pip list

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### é—®é¢˜2ï¼šå‰ç«¯æ„å»ºå¤±è´¥
```bash
# æ£€æŸ¥ Node ç‰ˆæœ¬
node -v  # åº”è¯¥æ˜¯ v18.x

# æ¸…ç†å¹¶é‡æ–°å®‰è£…
cd /root
rm -rf node_modules package-lock.json
npm install
npm run build
```

### é—®é¢˜3ï¼šNginx 403 é”™è¯¯
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /root/dist/

# è®¾ç½®æ­£ç¡®æƒé™
chmod -R 755 /root/dist
```

---

## âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] .env é…ç½®å·²å¡«å†™
- [ ] éƒ¨ç½²è„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [ ] PM2 æ˜¾ç¤ºåç«¯æœåŠ¡åœ¨çº¿
- [ ] Nginx è¿è¡Œæ­£å¸¸
- [ ] å¯ä»¥è®¿é—® http://semopic.com
- [ ] SSL è¯ä¹¦å·²é…ç½®ï¼ˆå¯é€‰ï¼‰

---

ğŸ‰ éƒ¨ç½²å®Œæˆï¼æœ‰ä»»ä½•é—®é¢˜éšæ—¶è”ç³»ã€‚
